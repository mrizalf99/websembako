<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Toko Sembako Arkana</title>

    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding-bottom: 230px;
      }

      /* HEADER */
      header {
        background: linear-gradient(135deg, #2e7d32, #66bb6a);
        color: white;
        padding: 20px;
        text-align: center;
      }

      /* PRODUK GRID */
      .product-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* HP: 2 kolom */
        gap: 15px;
        padding: 15px;
      }

      .product {
        background: #fff;
        border-radius: 10px;
        padding: 10px;
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .product img {
        width: 100%;
        border-radius: 8px;
      }

      .discount {
        position: absolute;
        top: 8px;
        left: 8px;
        background: red;
        color: #fff;
        font-size: 12px;
        padding: 3px 6px;
        border-radius: 5px;
      }

      .add-btn {
        width: 100%;
        margin-top: 8px;
        padding: 8px;
        border: none;
        background: #2ecc71;
        color: #fff;
        border-radius: 6px;
      }

      .product img {
        width: 100%;
        height: 130px;
        object-fit: contain;
      }

      .old-price {
        font-size: 12px;
        text-decoration: line-through;
        color: #999;
      }

      .new-price {
        font-weight: bold;
        color: #2e7d32;
      }

      .stock {
        font-size: 12px;
        margin-top: 4px;
      }

      select {
        width: 100%;
        padding: 6px;
        border-radius: 6px;
        margin-bottom: 6px;
      }

      button {
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }

      .add-btn {
        width: 100%;
        background: #25d366;
        color: white;
        padding: 8px;
        margin-top: 6px;
      }

      .add-btn:disabled {
        background: #aaa;
      }

      /* CHECKOUT */
      .checkout-form {
        background: white;
        margin: 20px;
        padding: 15px;
        border-radius: 10px;
      }

      label {
        font-size: 13px;
        font-weight: bold;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      /* CART */
      .cart {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        padding: 10px;
        box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
      }

      .cart-items-wrapper {
        max-height: 140px;
        overflow-y: auto;
      }

      .cart-item {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        margin-bottom: 6px;
      }

      .cart-controls button {
        padding: 3px 6px;
      }

      .qty-btn {
        background: #ddd;
      }

      .delete-btn {
        background: red;
        color: white;
      }

      .total {
        font-weight: bold;
        color: #2e7d32;
      }
    </style>
  </head>

  <body>
    <header>
      <h2>üõí Toko Sembako Arkana</h2>
      <p>Pilih Produk ‚Ä¢ Checkout ‚Ä¢ WhatsApp</p>
    </header>

    <div class="product-container">
      <!-- BERAS -->
      <div class="product" data-product-id="beras-premium">
        <div class="discount">15%</div>

        <img src="https://via.placeholder.com/200?text=Beras" />
        <h4>Beras Premium</h4>

        <select class="variant" onchange="updateHarga(this)">
          <option data-variant="5kg" data-price="75000" data-discount="15" data-stock="10">5 Kg</option>

          <option data-variant="10kg" data-price="140000" data-discount="15" data-stock="5">10 Kg</option>
        </select>

        <div class="old-price">Rp 75.000</div>
        <div class="new-price">Rp 65.000</div>
        <div class="stock">Stok: 10</div>

        <button class="add-btn" onclick="tambahKeranjangVarian(this)">Tambah</button>
      </div>

      <!-- MINYAK -->
      <div class="product" data-product-id="minyak-goreng">
        <div class="discount">20%</div>

        <img src="https://via.placeholder.com/200?text=Minyak" />
        <h4>Minyak Goreng</h4>

        <select class="variant" onchange="updateHarga(this)">
          <option data-price="15000" data-stock="20" data-variant="1lt" data-discount="0">1 Liter</option>
          <option data-price="70000" data-stock="8" data-variant="5lt" data-discount="5">5 Liter</option>
        </select>

        <div class="new-price">Rp 15.000</div>
        <div class="stock">Stok: 20</div>

        <button class="add-btn" onclick="tambahKeranjangVarian(this)">Tambah</button>
      </div>

      <!-- GULA -->
      <div class="product">
        <div class="discount">12%</div>

        <img src="https://via.placeholder.com/200?text=Gula" />
        <h4>Gula Pasir 1 Kg</h4>

        <div class="old-price">Rp 16.000</div>
        <div class="new-price">Rp 14.000</div>

        <button class="add-btn" onclick="tambahKeranjang('Gula Pasir 1 Kg',14000)">Tambah</button>
      </div>

      <!-- BERAS -->
      <div class="product" data-product-id="beras-premium2">
        <div class="discount">15%</div>

        <img src="https://via.placeholder.com/200?text=Beras" />
        <h4>Beras Premium2</h4>

        <select class="variant" onchange="updateHarga(this)">
          <option data-variant="5kg" data-price="75000" data-discount="15" data-stock="10">5 Kg</option>

          <option data-variant="10kg" data-price="140000" data-discount="15" data-stock="5">10 Kg</option>
        </select>

        <div class="old-price">Rp 75.000</div>
        <div class="new-price">Rp 65.000</div>
        <div class="stock">Stok: 10</div>

        <button class="add-btn" onclick="tambahKeranjangVarian(this)">Tambah</button>
      </div>
    </div>

    <!-- CHECKOUT -->
    <div id="checkout" class="checkout-form">
      <h3>üßæ Data Pembeli</h3>

      <label>Nama</label>
      <input id="nama" />

      <label>Alamat</label>
      <textarea id="alamat"></textarea>

      <label>Pembayaran</label>
      <select id="bayar">
        <option value="">-- Pilih --</option>
        <option>COD</option>
        <option>Transfer</option>
        <option>QRIS</option>
      </select>

      <button class="add-btn" onclick="kirimWA()">Kirim Pesanan</button>
    </div>

    <!-- CART -->
    <div class="cart">
      <div class="cart-items-wrapper">
        <div id="cartItems">Keranjang kosong</div>
      </div>
      <div class="total" id="totalHarga">Total: Rp 0</div>
      <button class="add-btn" onclick="scrollCheckout()">Checkout</button>
    </div>

    <script>
      let keranjang = {};

      // PRODUK NORMAL
      function tambahKeranjang(nama, harga) {
        keranjang[nama] ? keranjang[nama].qty++ : (keranjang[nama] = { harga, qty: 1 });
        renderKeranjang();
      }

      // PRODUK VARIAN
      function updateHarga(select) {
        const p = select.closest(".product");
        const opt = select.selectedOptions[0];

        const hargaAsli = Number(opt.dataset.price);
        const diskon = Number(opt.dataset.discount);
        const stok = Number(opt.dataset.stock);

        const hargaDiskon = Math.round(hargaAsli - (hargaAsli * diskon) / 100);

        p.querySelector(".old-price").innerText = "Rp " + hargaAsli.toLocaleString();

        p.querySelector(".new-price").innerText = "Rp " + hargaDiskon.toLocaleString();

        p.querySelector(".stock").innerText = "Stok: " + stok;

        p.querySelector(".discount").innerText = diskon + "%";
      }

      function tambahKeranjangVarian(btn) {
        const p = btn.closest(".product");
        const select = p.querySelector(".variant");
        const opt = select.selectedOptions[0];

        let stok = Number(opt.dataset.stock);
        if (stok <= 0) {
          alert("Stok habis!");
          return;
        }

        const productId = p.dataset.productId;
        const variant = opt.dataset.variant;
        const namaProduk = p.querySelector("h4").innerText;

        const hargaAsli = Number(opt.dataset.price);
        const diskon = Number(opt.dataset.discount);
        const harga = Math.round(hargaAsli - (hargaAsli * diskon) / 100);

        const key = `${productId}_${variant}`;

        if (!keranjang[key]) {
          keranjang[key] = {
            nama: `${namaProduk} (${variant})`,
            harga: harga,
            qty: 1,
          };
        } else {
          keranjang[key].qty++;
        }

        // Kurangi stok
        stok--;
        opt.dataset.stock = stok;
        p.querySelector(".stock").innerText = "Stok: " + stok;

        renderKeranjang();
      }

      // Kurangi stok
      stok--;
      option.dataset.stock = stok;
      p.querySelector(".stock").innerText = "Stok: " + stok;

      renderKeranjang();

      function ubahQty(key, delta) {
        keranjang[key].qty += delta;
        if (keranjang[key].qty <= 0) delete keranjang[key];
        renderKeranjang();
      }

      function hapusItem(key) {
        delete keranjang[key];
        renderKeranjang();
      }

      function hapusItem(nama) {
        delete keranjang[nama];
        renderKeranjang();
      }

      function renderKeranjang() {
        let html = "";
        let total = 0;

        for (let key in keranjang) {
          const item = keranjang[key];
          const sub = item.harga * item.qty;
          total += sub;

          html += `
    <div class="cart-item">
      <div class="cart-left">
        ${item.nama}<br>Rp ${sub.toLocaleString()}
      </div>
      <div class="cart-controls">
        <button class="qty-btn" onclick="ubahQty('${key}',-1)">‚àí</button>
        ${item.qty}
        <button class="qty-btn" onclick="ubahQty('${key}',1)">+</button>
        <button class="delete-btn" onclick="hapusItem('${key}')">üóëÔ∏è</button>
      </div>
    </div>`;
        }

        document.getElementById("cartItems").innerHTML = html || "Keranjang kosong";

        document.getElementById("totalHarga").innerText = "Total: Rp " + total.toLocaleString();
      }

      function scrollCheckout() {
        if (!Object.keys(keranjang).length) return alert("Keranjang kosong!");
        document.getElementById("checkout").scrollIntoView({ behavior: "smooth" });
      }

      function kirimWA() {
        let nama = document.getElementById("nama").value;
        let alamat = document.getElementById("alamat").value;
        let bayar = document.getElementById("bayar").value;

        if (!nama || !alamat || !bayar) {
          alert("Lengkapi data pembeli dulu yaa!");
          return;
        }

        let pesan = `NOTA PEMESANAN
Toko Sembako Arkana
------------------------
Nama   : ${nama}
Alamat : ${alamat}
Bayar  : ${bayar}

Pesanan:
`;

        let total = 0;
        for (let item in keranjang) {
          let sub = keranjang[item].harga * keranjang[item].qty;
          total += sub;
          pesan += `- ${item} x ${keranjang[item].qty} = Rp ${sub.toLocaleString()}\n`;
        }

        pesan += `
------------------------
Total: Rp ${total.toLocaleString()}

Terima kasih.`;

        window.open("https://wa.me/6281546068582?text=" + encodeURIComponent(pesan), "_blank");
      }
    </script>
  </body>
</html>
